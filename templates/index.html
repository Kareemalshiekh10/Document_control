{% extends 'base.html' %}

{% block content %}
    <h2 class="text-xl font-semibold mb-4">Upload Document</h2>
    <form method="POST" enctype="multipart/form-data" action="{{ url_for('upload_file') }}" class="mb-8">
        <div class="mb-4">
            <label for="file" class="block text-sm font-medium text-gray-700">Select File</label>
            <input type="file" id="file" name="file" class="mt-1 block w-full border-gray-300 rounded-md">
        </div>
        <div class="mb-4">
            <label for="document_type" class="block text-sm font-medium text-gray-700">Document Type</label>
            <select id="document_type" name="document_type" class="mt-1 block w-full border-gray-300 rounded-md">
                {% for type in document_types %}
                    <option value="{{ type.id }}">{{ type.type_name }}</option>
                {% endfor %}
            </select>
        </div>
        <div class="mb-4">
            <label for="project" class="block text-sm font-medium text-gray-700">Project</label>
            <select id="project" name="project" class="mt-1 block w-full border-gray-300 rounded-md">
                {% for project in projects %}
                    <option value="{{ project.id }}">{{ project.project_name }}</option>
                {% endfor %}
            </select>
        </div>
        <div class="mb-4">
            <label for="site" class="block text-sm font-medium text-gray-700">Site</label>
            <select id="site" name="site" class="mt-1 block w-full border-gray-300 rounded-md">
                {% for site in sites %}
                    <option value="{{ site.id }}">{{ site.site_name }}</option>
                {% endfor %}
            </select>
        </div>
        <div class="mb-4">
            <label for="status" class="block text-sm font-medium text-gray-700">Status</label>
            <select id="status" name="status" class="mt-1 block w-full border-gray-300 rounded-md">
                {% for status in statuses %}
                    <option value="{{ status.id }}">{{ status.status_name }}</option>
                {% endfor %}
            </select>
        </div>
        <div class="mb-4">
            <label for="user" class="block text-sm font-medium text-gray-700">Uploaded By</label>
            <select id="user" name="user" class="mt-1 block w-full border-gray-300 rounded-md">
                {% for user in users %}
                    <option value="{{ user.id }}">{{ user.username }}</option>
                {% endfor %}
            </select>
        </div>
        <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700">Upload</button>
    </form>

    <h2 class="text-xl font-semibold mb-4">Filter Documents</h2>
    <form method="POST" class="mb-8">
        <input type="hidden" name="filter" value="true">
        <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-4">
            <div>
                <label for="filter_document_type" class="block text-sm font-medium text-gray-700">Document Type</label>
                <select id="filter_document_type" name="document_type" class="mt-1 block w-full border-gray-300 rounded-md">
                    <option value="">All</option>
                    {% for type in document_types %}
                        <option value="{{ type.id }}" {% if filters.document_type == type.id|string %}selected{% endif %}>{{ type.type_name }}</option>
                    {% endfor %}
                </select>
            </div>
            <div>
                <label for="filter_project" class="block text-sm font-medium text-gray-700">Project</label>
                <select id="filter_project" name="project" class="mt-1 block w-full border-gray-300 rounded-md">
                    <option value="">All</option>
                    {% for project in projects %}
                        <option value="{{ project.id }}" {% if filters.project == project.id|string %}selected{% endif %}>{{ project.project_name }}</option>
                    {% endfor %}
                </select>
            </div>
            <div>
                <label for="filter_site" class="block text-sm font-medium text-gray-700">Site</label>
                <select id="filter_site" name="site" class="mt-1 block w-full border-gray-300 rounded-md">
                    <option value="">All</option>
                    {% for site in sites %}
                        <option value="{{ site.id }}" {% if filters.site == site.id|string %}selected{% endif %}>{{ site.site_name }}</option>
                    {% endfor %}
                </select>
            </div>
            <div>
                <label for="filter_status" class="block text-sm font-medium text-gray-700">Status</label>
                <select id="filter_status" name="status" class="mt-1 block w-full border-gray-300 rounded-md">
                    <option value="">All</option>
                    {% for status in statuses %}
                        <option value="{{ status.id }}" {% if filters.status == status.id|string %}selected{% endif %}>{{ status.status_name }}</option>
                    {% endfor %}
                </select>
            </div>
        </div>
        <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700">Apply Filter</button>
    </form>

    <h2 class="text-xl font-semibold mb-4">Documents</h2>
    <table class="w-full border-collapse border border-gray-300">
        <thead>
            <tr class="bg-gray-200">
                <th class="border border-gray-300 p-2">File Name</th>
                <th class="border border-gray-300 p-2">Type</th>
                <th class="border border-gray-300 p-2">Project</th>
                <th class="border border-gray-300 p-2">Site</th>
                <th class="border border-gray-300 p-2">Status</th>
                <th class="border border-gray-300 p-2">Uploaded By</th>
                <th class="border border-gray-300 p-2">Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for doc in documents %}
                <tr>
                    <td class="border border-gray-300 p-2">{{ doc.file_name }}</td>
                    <td class="border border-gray-300 p-2">{{ doc.type_name }}</td>
                    <td class="border border-gray-300 p-2">{{ doc.project_name }}</td>
                    <td class="border border-gray-300 p-2">{{ doc.site_name }}</td>
                    <td class="border border-gray-300 p-2">{{ doc.status_name }}</td>
                    <td class="border border-gray-300 p-2">{{ doc.username }}</td>
                    <td class="border border-gray-300 p-2">
                        <form method="POST" action="{{ url_for('delete_file', document_id=doc.id) }}" onsubmit="return confirm('Are you sure you want to delete this document?');">
                            <button type="submit" class="bg-red-600 text-white px-2 py-1 rounded-md hover:bg-red-700">Delete</button>
                        </form>
                    </td>
                </tr>
            {% endfor %}
        </tbody>
    </table>
{% endblock %}