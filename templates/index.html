{% extends 'base.html' %}

{% block content %}
    <h2 class="text-2xl font-semibold text-gray-800 mb-6">Upload Document</h2>
    <div class="form-container">
        <form id="upload-form" method="POST" enctype="multipart/form-data" action="{{ url_for('upload_file') }}" class="space-y-4">
            <div>
                <label for="file" class="block text-sm font-medium text-gray-700">Select File</label>
                <input type="file" id="file" name="file" class="mt-1 block w-full border-gray-300 rounded-md">
            </div>
            <div>
                <label for="document_type" class="block text-sm font-medium text-gray-700">Document Type</label>
                <select id="document_type" name="document_type" class="mt-1 block w-full border-gray-300 rounded-md">
                    {% for type in document_types %}
                        <option value="{{ type.id }}">{{ type.type_name }}</option>
                    {% endfor %}
                </select>
            </div>
            <div>
                <label for="project" class="block text-sm font-medium text-gray-700">Project</label>
                <select id="project" name="project" class="mt-1 block w-full border-gray-300 rounded-md">
                    {% for project in projects %}
                        <option value="{{ project.id }}">{{ project.project_name }}</option>
                    {% endfor %}
                </select>
            </div>
            <div>
                <label for="site" class="block text-sm font-medium text-gray-700">Site</label>
                <select id="site" name="site" class="mt-1 block w-full border-gray-300 rounded-md">
                    {% for site in sites %}
                        <option value="{{ site.id }}">{{ site.site_name }}</option>
                    {% endfor %}
                </select>
            </div>
            <div>
                <label for="status" class="block text-sm font-medium text-gray-700">Status</label>
                <select id="status" name="status" class="mt-1 block w-full border-gray-300 rounded-md">
                    {% for status in statuses %}
                        <option value="{{ status.id }}">{{ status.status_name }}</option>
                    {% endfor %}
                </select>
            </div>
            <div>
                <label for="user" class="block text-sm font-medium text-gray-700">Uploaded By</label>
                <select id="user" name="user" class="mt-1 block w-full border-gray-300 rounded-md">
                    {% for user in users %}
                        <option value="{{ user.id }}">{{ user.username }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="flex items-center">
                <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700">Upload</button>
                <span id="upload-spinner" class="loading-spinner"></span>
            </div>
        </form>
    </div>

    <h2 class="text-2xl font-semibold text-gray-800 mb-6">Filter Documents</h2>
    <div class="form-container">
        <form id="filter-form" method="POST" class="space-y-4">
            <input type="hidden" name="filter" value="true">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                <div>
                    <label for="filter_document_type" class="block text-sm font-medium text-gray-700"> DOCUMENT Type</label>
                    <select id="filter_document_type" name="document_type" class="mt-1 block w-full border-gray-300 rounded-md">
                        <option value="">All</option>
                        {% for type in document_types %}
                            <option value="{{ type.id }}" {% if filters.document_type == type.id|string %}selected{% endif %}>{{ type.type_name }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div>
                    <label for="filter_project" class="block text-sm font-medium text-gray-700">Project</label>
                    <select id="filter_project" name="project" class="mt-1 block w-full border-gray-300 rounded-md">
                        <option value="">All</option>
                        {% for project in projects %}
                            <option value="{{ project.id }}" {% if filters.project == project.id|string %}selected{% endif %}>{{ project.project_name }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div>
                    <label for="filter_site" class="block text-sm font-medium text-gray-700">Site</label>
                    <select id="filter_site" name="site" class="mt-1 block w-full border-gray-300 rounded-md">
                        <option value="">All</option>
                        {% for site in sites %}
                            <option value="{{ site.id }}" {% if filters.site == site.id|string %}selected{% endif %}>{{ site.site_name }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div>
                    <label for="filter_status" class="block text-sm font-medium text-gray-700">Status</label>
                    <select id="filter_status" name="status" class="mt-1 block w-full border-gray-300 rounded-md">
                        <option value="">All</option>
                        {% for status in statuses %}
                            <option value="{{ status.id }}" {% if filters.status == status.id|string %}selected{% endif %}>{{ status.status_name }}</option>
                        {% endfor %}
                    </select>
                </div>
            </div>
            <div class="flex items-center space-x-4">
                <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700">Apply Filter</button>
                <button type="button" id="clear-filters" class="bg-gray-500 text-white px-4 py-2 rounded-md hover:bg-gray-600">Clear Filters</button>
                <span id="filter-spinner" class="loading-spinner"></span>
            </div>
        </form>
    </div>

    <h2 class="text-2xl font-semibold text-gray-800 mb-6">Documents</h2>
    <div class="table-container">
        <table class="w-full">
            <thead>
                <tr class="bg-gray-200">
                    <th class="border-b border-gray-300 p-3 text-left">File Name</th>
                    <th class="border-b border-gray-300 p-3 text-left">Type</th>
                    <th class="border-b border-gray-300 p-3 text-left">Project</th>
                    <th class="border-b border-gray-300 p-3 text-left">Site</th>
                    <th class="border-b border-gray-300 p-3 text-left">Status</th>
                    <th class="border-b border-gray-300 p-3 text-left">Uploaded By</th>
                    <th class="border-b border-gray-300 p-3 text-left">Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for doc in documents %}
                    <tr>
                        <td class="border-b border-gray-300 p-3">{{ doc.file_name }}</td>
                        <td class="border-b border-gray-300 p-3">{{ doc.type_name }}</td>
                        <td class="border-b border-gray-300 p-3">{{ doc.project_name }}</td>
                        <td class="border-b border-gray-300 p-3">{{ doc.site_name }}</td>
                        <td class="border-b border-gray-300 p-3">{{ doc.status_name }}</td>
                        <td class="border-b border-gray-300 p-3">{{ doc.username }}</td>
                        <td class="border-b border-gray-300 p-3">
                            <form class="delete-form" method="POST" action="{{ url_for('delete_file', document_id=doc.id) }}" onsubmit="return confirm('Are you sure you want to delete this document?');">
                                <div class="flex items-center">
                                    <button type="submit" class="bg-red-600 text-white px-2 py-1 rounded-md hover:bg-red-700">Delete</button>
                                    <span class="delete-spinner loading-spinner ml-2"></span>
                                </div>
                            </form>
                        </td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
{% endblock %}